# 以函数对象取代函数

replace function with command 以命令取代函数 (337)

曾用名： 以函数对象取代函数（Replace Method with Method Object）
反向重构：以函数取代命令（344）


## 动机

&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; 我在本书中不断向读者强调⼩型函数的优美动⼈。
只要将相对独⽴的代码从⼤型函数中提炼出来，就可以⼤⼤提⾼代码的可读性。  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; 但是，局部变量的存在会增加函数分解难度。如果⼀个函数之中局部变量泛滥成灾，那么想分解这个函数是⾮常困难的。
Replace Temp with Query （120）可以助你 减轻这⼀负担，但有时候你会发现根本⽆法拆解⼀个需要拆解的函数。
这种情况下，你应该把⼿伸进⼯具箱的深处，祭出函数对象（method object）［Beck]这件法宝。
Replace Method with Method Object （135）会将所有 局部变量 都变成 函数对象的字段。
然后,你就可以对这个新对象 使⽤Extract Method（110）创造出新函数，从⽽将原本的⼤型函数拆解变短。

## 做法
我厚着脸⽪从Kent Beck ［Beckj那⾥偷来了下列做法。
-[ ] 建⽴⼀个新类，根据待处理函数的⽤途，为这个类命名。 
-[ ] 在新类中建⽴⼀个final字段，⽤以保存原先⼤型函数所在的对象。我们将这个字段称为“源对象”。
     同时，针对原函数的每个临时变量和每个参数，在新类中建⽴⼀个对应的字段保存之。 
-[ ] 在新类中建⽴⼀个构造函数，接收“源对象”及原函数的所有参数作为参数。  
-[ ] 在新类中建⽴⼀个compute()函数。  
-[x] 将原函数的代码复制到compute()函数中。如果需要调⽤源对象的任何函数，请通过源对象字段调⽤。  
-[ ] 编译。   
-[ ] 将旧函数的函数本体替换为这样⼀条语句：“创建上述新类的⼀个新对象，⽽后调⽤其中的compute()函数”。  

&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; 现在进⾏到很有趣的部分了。
由于所有局部变量现在都成了字段，所以, 你可以任意分解这个⼤型函数，不必传递任何参数。

## 范例
见代码  section8

